function panneauGaucheAddListener(a){a.each(function(b){Event.observe(b,"keydown",function(c){if(c.keyCode==13){switch($("panneau_deition_curent_mode").value){case panneau_deition_modes.creation:ValiderEvent(scale_used);break;case panneau_deition_modes.edition:MajEvent(scale_used);break;default:break}return}if(c.keyCode==27){switch($("panneau_deition_curent_mode").value){case panneau_deition_modes.creation:AnnulerEvent(scale_used);break;case panneau_deition_modes.edition:panneau_eition_reset_formulaire();break;default:break}return}},false)})}function refresh_grille_agenda(a){if(a!=undefined){Udate_used=a}switch(scale_used){case"jour":page.traitecontent("agenda_jour","agenda_view_jour.php?Udate_used="+Udate_used+"&HEURE_DE_DEPART="+$("grille_jour").scrollTop,true,"grille_agenda");break;case"mois":page.traitecontent("agenda_mois","agenda_view_mois.php?Udate_used="+Udate_used,true,"grille_agenda");break;case"semaine":page.traitecontent("agenda_semaine","agenda_view_semaine.php?Udate_used="+Udate_used+"&HEURE_DE_DEPART="+$("grille_semaine").scrollTop,true,"grille_agenda");break}}function resizeMaxHeight(){var a=getWindowHeight();$("panneau_gauche").style.maxHeight=(a-365)+"px";$("panneau_event_edition").style.maxHeight=(a-200)+"px";switch(scale_used){case"jour":$("grille_jour").style.maxHeight=(a-185)+"px";ecarterEvenements(0);break;case"semaine":$("grille_semaine").style.maxHeight=(a-185)+"px";ecarterEvenements(0);ecarterEvenements(1);ecarterEvenements(2);ecarterEvenements(3);ecarterEvenements(4);ecarterEvenements(5);ecarterEvenements(6);break;case"mois":$("grille_mois").style.maxHeight=(a-185)+"px";break}}function genLibEvent(){return"LIB"}function getHeure(f){var c="(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9])";c+="|(0[0-9]|1[0-9]|2[0-3])h([0-5][0-9])";c+="|(0[0-9]|1[0-9]|2[0-3])H([0-5][0-9])";c+="|(0[0-9]|1[0-9]|2[0-3])-([0-5][0-9])";c+="|(0[0-9]|1[0-9]|2[0-3]) ([0-5][0-9])";var d=new RegExp(c,"i");var e=new RegExp("[-hH:]","g");if(f==""){return Number.NaN}else{if(!d.test(f)){return Number.NaN}}var b;var a;var g=f.split(e);a=new Date(0);a.setHours(parseInt(g[0],10));a.setMinutes(parseInt(g[1],10));if(a==null){return Number.NaN}else{return a.getTime()}}function buildStrTime(b,c,a){var d="";if(b<10){d+="0"+b+c}else{d+=b+c}if(a<10){d+="0"+a}else{d+=a}return d}function panneau_edition_verifier_formulaire(){text_alertes={lib:"Le titre de l'événement n'est pas spécifié.",date_de_deb:"La date de début de l'événement est incorrecte",date_de_fin:"La date de fin de l'événement est incorrecte",heure_de_deb:"L'heure de début de l'événement est incorrecte",heure_de_fin:"L'heure de fin de l'événement est incorrecte",qte:"La quantité saisie est nulle"};alertes=new Array();var c=false;if($("evt_edition_lib2").value==""){alertes.push(text_alertes.lib)}var b=false;var n=false;var r=false;var k=false;var g=false;var j="(0[1-9]|[12][0-9]|3[01])/(0[1-9]|1[0-2])/(19[7-9][0-9]|20[0-3][0-9])";j+="|(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[0-2])-(19[7-9][0-9]|20[0-3][0-9])";j+="|(0[1-9]|[12][0-9]|3[01]).(0[1-9]|1[0-2]).(19[7-9][0-9]|20[0-3][0-9])";j+="|(0[1-9]|[12][0-9]|3[01]) (0[1-9]|1[0-2]) (19[7-9][0-9]|20[0-3][0-9])";var l=new RegExp(j,"i");var f="(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9])";f+="|(0[0-9]|1[0-9]|2[0-3])h([0-5][0-9])";f+="|(0[0-9]|1[0-9]|2[0-3])H([0-5][0-9])";f+="|(0[0-9]|1[0-9]|2[0-3])-([0-5][0-9])";f+="|(0[0-9]|1[0-9]|2[0-3]) ([0-5][0-9])";var e=new RegExp(f,"i");var m=new RegExp("[-.s/]","g");var o=new RegExp("[-hH:]","g");if($("evt_edition_date_deb").value==""){alertes.push(text_alertes.date_de_deb);b=true}else{if(!l.test($("evt_edition_date_deb").value)){alertes.push(text_alertes.date_de_deb);b=true}}if($("evt_edition_heure_deb").value==""){alertes.push(text_alertes.heure_de_deb);r=true}else{if(!e.test($("evt_edition_heure_deb").value)){alertes.push(text_alertes.heure_de_deb);r=true}}if($("evt_edition_date_fin").value==""){alertes.push(text_alertes.date_de_fin);n=true}else{if(!l.test($("evt_edition_date_fin").value)){alertes.push(text_alertes.date_de_fin);n=true}}if($("evt_edition_heure_fin").value==""){alertes.push(text_alertes.heure_de_fin);k=true}else{if(!e.test($("evt_edition_heure_fin").value)){alertes.push(text_alertes.heure_de_fin);k=true}}if($("evt_edition_qte")){if($("evt_edition_qte").value==""){alertes.push(text_alertes.qte);g=true}}var h;if(!b&&!r){var d=$("evt_edition_date_deb").value.split(m);var q=$("evt_edition_heure_deb").value.split(o);date_deb=new Date(parseInt(d[2],10),parseInt(d[1],10)-1,parseInt(d[0],10),parseInt(q[0],10),parseInt(q[1],10),0,0);delete (d);delete (q);if(date_deb==null){alertes.push(text_alertes.date_de_deb);alertes.push(text_alertes.date_de_deb);b=true;r=true}}if(!n&&!k){var a=$("evt_edition_date_fin").value.split(m);var p=$("evt_edition_heure_fin").value.split(o);h=new Date(parseInt(a[2],10),parseInt(a[1],10)-1,parseInt(a[0],10),parseInt(p[0],10),parseInt(p[1],10),0,0);delete (a);delete (p);if(h==null){alertes.push(text_alertes.date_de_fin);alertes.push(text_alertes.heure_de_fin);n=true;k=true}}if(!b&&!r&&!n&&!k&&date_deb.getTime()>=h.getTime()){alert("["+$("evt_edition_date_deb").value+" "+$("evt_edition_heure_deb").value+"] ["+$("evt_edition_date_fin").value+" "+$("evt_edition_heure_fin").value+"]");alert(" date_deb.getTime()"+date_deb.getTime()+"date_fin.getTime()"+h.getTime());alertes.push(text_alertes.date_de_deb);alertes.push(text_alertes.heure_de_deb);alertes.push(text_alertes.date_de_fin);alertes.push(text_alertes.heure_de_fin);b=true;r=true;n=true;k=true}if(alertes.length>0){alert((""+alertes.valueOf()).replace(/,/g,"\n"))}if($("evt_edition_qte")){return !(b||r||n||k||g)}else{return !(b||r||n||k)}}function panneau_eition_reset_formulaire(){$("ref_event").value="";$("id_graphic_event").value="";$("evt_edition_lib").value="";$("evt_edition_agenda_old").value="";$("evt_edition_type_event_old").value="";$("evt_edition_agenda_selected").selectedIndex=0;$("evt_edition_type_event_selected").innerHTML="";$("evt_edition_date_deb").value="";$("evt_edition_heure_deb").value="";$("evt_edition_date_fin").value="";$("evt_edition_heure_fin").value="";$("evt_edition_note").value="";$("AnnulerEvent").hide();$("ValiderEvent").hide();$("SupprimerEvent").hide();$("MajEvent").hide();$("SaveNewEvent").hide();evt_edition_heure_deb=Number.NaN;evt_edition_heure_fin=Number.NaN;$("panneau_event_edition").hide();$("panneau_event_edit_part_evenement").hide();$("panneau_event_edit_part_agenda").hide();$("panneau_event_edit_part_type_event").hide();$("panneau_event_edit_part_dates").hide();$("panneau_event_edit_part_notes").hide();$("panneau_deition_curent_mode").value=0}function genIdGraphicEvent(){return(new Date()).getTime()+""+Math.floor(Math.random())}function horloge_dynamique(b){if($("target")){var a=new Date();$(b).innerHTML="";if(a.getHours()>=0&&a.getHours()<10){$(b).innerHTML+="0"}$(b).innerHTML+=a.getHours()+":";if(a.getMinutes()>=0&&a.getMinutes()<10){$(b).innerHTML+="0"}$(b).innerHTML+=a.getMinutes()+":";if(a.getSeconds()>=0&&a.getSeconds()<10){$(b).innerHTML+="0"}$(b).innerHTML+=a.getSeconds();window.setTimeout("horloge_dynamique('"+b+"')",1000)}}function genHexColor(){var a=new Array(14);a[0]="0";a[1]="1";a[2]="2";a[3]="3";a[4]="4";a[5]="5";a[5]="6";a[6]="7";a[7]="8";a[8]="9";a[9]="a";a[10]="b";a[11]="c";a[12]="d";a[13]="e";a[14]="f";var b="";for(i=0;i<6;i++){b+=a[Math.round(Math.random()*14)]}return b}function CreateDivEvenement(h,g,f,d,b,a){var c=document.createElement("div");c.id=h;c.className="event_div_principale";c.style.top=g+"px";c.style.left=f+"px";c.style.width=d+"px";c.style.height=(b-7)+"px";c.style.borderColor="#e0aeaf";c.style.backgroundColor="#995650";agendaCouleur1=read_cook("cook_agenda_selectedC1");agendaCouleur2=read_cook("cook_agenda_selectedC2");if(agendaCouleur1!=""&&agendaCouleur2!=""){c.style.backgroundColor="#"+agendaCouleur2;var e='<div id="event_CONETNU_'+h+'" style="height:100%;" ><div id="event_moveG'+h+'" class="event_div_titre_G" style="background-color:#'+agendaCouleur1+';"></div><div id="event_moveD'+h+'" class="event_div_titre_D" style="background-color:#'+agendaCouleur1+';">&nbsp;</div><div id="event_DESCRIP_'+h+'" class="event_div_description" style="border-color:#FEFEFE;"></div></div><div id="event_edit_'+h+'" class="event_div_edition_zone"></div>'}else{var e='<div id="event_CONETNU_'+h+'" style="height:100%;" ><div id="event_moveG'+h+'" class="event_div_titre_G" style="background-color:#7f2d22;"></div><div id="event_moveD'+h+'" class="event_div_titre_D" style="background-color:#7f2d22;">=</div><div id="event_DESCRIP_'+h+'" class="event_div_description" style="border-color:#e0aeaf;"></div></div><div id="event_edit_'+h+'" class="event_div_edition_zone"></div>'}c.innerHTML=e;return c}function showOnPanel(e,a,f,c,d,g){if(f!=undefined){var b=new Ajax.Request("agenda_view_event_on_panneau_edition.php",{method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:{echelle:e,id_graphic_event:a,ref_event:f,Udate_event:c,duree_event:d,readonly:g},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(h){h.responseText.evalScripts()},onComplete:H_loading})}else{var b=new Ajax.Request("agenda_view_event_new_on_panneau_edition.php",{method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:{echelle:e,id_graphic_event:a,ref_event:f,Udate_event:c,duree_event:d},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(h){h.responseText.evalScripts()},onComplete:H_loading})}}function agenda_operation_maj_event(h,e,l,k,f,m,j,a,c,g,d){var b=new Ajax.Request("agenda_operation_maj_event.php",{method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:{scale_used:h,id_graphic_event:e,ref_agenda:l,id_type_event:k,ref_event:f,event_lib:m,sdate_deb:j,sheure_deb:a,sdate_fin:c,sheure_fin:g,note:d},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(n){n.responseText.evalScripts();panneau_eition_reset_formulaire()},onComplete:H_loading})}function agenda_operation_maj_event_location(k,f,n,m,g,o,l,b,d,h,e,a,j){var c=new Ajax.Request("agenda_operation_maj_event_location.php",{method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:{scale_used:k,id_graphic_event:f,ref_agenda:n,id_type_event:m,ref_event:g,event_lib:o,sdate_deb:l,sheure_deb:b,sdate_fin:d,sheure_fin:h,note:e,id_stock:a,qte:j},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(p){p.responseText.evalScripts();panneau_eition_reset_formulaire()},onComplete:H_loading})}function agenda_operation_add_event(g,e,k,j,l,h,a,c,f,d){var b=new Ajax.Request("agenda_operation_add_event.php",{parameters:{scale_used:g,id_graphic_event:e,id_type_event:j,event_lib:l,ref_agenda:k,sdate_deb:h,sheure_deb:a,sdate_fin:c,sheure_fin:f,note:d},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(m){m.responseText.evalScripts()},onComplete:H_loading})}function agenda_operation_add_event_location(j,f,m,l,n,k,b,d,g,e,a,h){var c=new Ajax.Request("agenda_operation_add_event_location.php",{parameters:{scale_used:j,id_graphic_event:f,id_type_event:l,event_lib:n,ref_agenda:m,sdate_deb:k,sheure_deb:b,sdate_fin:d,sheure_fin:g,note:e,id_stock:a,qte:h},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(o){o.responseText.evalScripts()},onComplete:H_loading})}function agenda_operation_delete_event(b,a,d){var c=new Ajax.Request("agenda_operation_delete_event.php",{parameters:{scale_used:b,id_graphic_event:a,ref_event:d},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(e){e.responseText.evalScripts()},onComplete:H_loading})}function majSelect_Options_events_types(e,c,d,b){sDroitsCibles="";if(b!=undefined){sDroitsCibles=b.valueOf()}var a=new Ajax.Updater(d.id,"agenda_maj_select_options_events_types.php",{method:"post",contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:{id_agenda:e,ref_agenda:c,droitsCibles:sDroitsCibles},evalScripts:false,asynchronous:false,onCreate:function(){d.disabled="disabled"},onException:function(){S_failure()},onSuccess:function(f){},onComplete:function(){d.disabled="";showResponse}})}function majSelect_type_formulaire(b,c){var a=new Ajax.Updater(c.id,"agenda_maj_select_type_formulaire.php",{method:"post",contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:{ref_agenda:b},evalScripts:true,asynchronous:false,onCreate:function(){c.disabled="disabled"},onException:function(){S_failure()},onSuccess:function(d){},onComplete:function(){c.disabled="";showResponse}})}function majQte_stock(h,g,d,f,e,c,b){var a=new Ajax.Updater(h,"agenda_maj_qte_stock.php",{method:"post",contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:{id_stock:g,ref_article:d,ref_agenda:f,date_deb:e,heure_deb:c,heure_fin:b},evalScripts:false,asynchronous:false,onCreate:function(){h.disabled="disabled"},onException:function(){S_failure()},onSuccess:function(j){},onComplete:function(){h.disabled="";showResponse}})}function sort(d,c){return parseInt(d.id)-parseInt(c.id)}function reverse(d,c){return parseInt(c.id)-parseInt(d.id)}function sortByHeight(d,c){return parseInt(d.height)-parseInt(c.height)}function reverseByHeight(d,c){return parseInt(c.height)-parseInt(d.height)}function majAgendasUsersAgendasAffichage(f,c,b,e){var d=false;var a=new Ajax.Request("agenda_operation_afficher_agenda.php",{parameters:{ref_user:f,ref_agenda:c,affichage:b,fonctionRetour:e},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(g){g.responseText.evalScripts()},onComplete:H_loading})}function page_agenda_selectionner_agendas_result_fct_retour(c,b,a){if(b){$(c).checked="checked";$("panneau_agendas_agenda_cell_text_"+a).className="panneau_agendas_enable_text";$("panneau_agendas_agenda_ligne_"+a).show()}else{$(c).checked="";$("panneau_agendas_agenda_ligne_"+a).hide()}}function page_accueil_fct_retour_afficher_agenda(c,b,a){if(b){$(c).className="panneau_agendas_enable_text"}else{$(c).className="panneau_agendas_disable_text"}refresh_grille_agenda()}function majAgendasUsersEventsTypesAffichage(f,d,b,e){var c=false;var a=new Ajax.Request("agenda_operation_afficher_events_types.php",{parameters:{ref_user:f,id_type_event:d,affichage:b,fonctionRetour:e},evalScripts:true,onLoading:S_loading,onException:function(){S_failure()},onSuccess:function(g){g.responseText.evalScripts()},onComplete:H_loading})}function page_agenda_selectionner_types_events_result_fct_retour_afficher_events_types(c,a,b){if(a){$(c).checked="checked";$("panneau_agendas_event_type_cell_text_"+b).className="panneau_agendas_enable_text";$("panneau_agendas_types_events_ligne_"+b).show()}else{$(c).checked="";$("panneau_agendas_types_events_ligne_"+b).hide()}}function page_accueil_fct_retour_afficher_events_types(c,a,b){if(a){$(c).className="panneau_agendas_enable_text"}else{$(c).className="panneau_agendas_disable_text"}refresh_grille_agenda()}function AnnulerEvent(a){var b=evenements[$("id_graphic_event").value].cellJour;evenements[$("id_graphic_event").value].deleteThis();panneau_eition_reset_formulaire();ecarterEvenements(b);gride_is_locked=false}function ValiderEvent(a){if(panneau_edition_verifier_formulaire()){agenda_operation_add_event(a,$("id_graphic_event").value,$("evt_edition_agenda_selected").options[$("evt_edition_agenda_selected").selectedIndex].value,$("evt_edition_type_event_selected").options[$("evt_edition_type_event_selected").selectedIndex].value,$("evt_edition_lib2").value,$("evt_edition_date_deb").value,$("evt_edition_heure_deb").value,$("evt_edition_date_fin").value,$("evt_edition_heure_fin").value,$("evt_edition_note").value)}}function ValiderEventLocation(a){if(panneau_edition_verifier_formulaire()){agenda_operation_add_event_location(a,$("id_graphic_event").value,$("evt_edition_agenda_selected").options[$("evt_edition_agenda_selected").selectedIndex].value,$("evt_edition_type_event_selected").options[$("evt_edition_type_event_selected").selectedIndex].value,$("evt_edition_lib2").value,$("evt_edition_date_deb").value,$("evt_edition_heure_deb").value,$("evt_edition_date_fin").value,$("evt_edition_heure_fin").value,$("evt_edition_note").value,$("evt_choix_stock").value,$("evt_edition_qte").value)}}function SaveNewEvent(a){if(panneau_edition_verifier_formulaire()){agenda_operation_add_event(a,$("evt_edition_lib2").value,$("evt_edition_agenda_selected").options[$("evt_edition_agenda_selected").selectedIndex].value,$("evt_edition_date_deb").value,$("evt_edition_heure_deb").value,$("evt_edition_date_fin").value,$("evt_edition_heure_fin").value,$("evt_edition_note").value);$("SaveNewEvent").hide()}}function MajEvent(a){if(autoUpdate&&panneau_edition_verifier_formulaire()){agenda_operation_maj_event(a,$("id_graphic_event").value,$("evt_edition_agenda_selected").options[$("evt_edition_agenda_selected").selectedIndex].value,$("evt_edition_type_event_selected").options[$("evt_edition_type_event_selected").selectedIndex].value,$("ref_event").value,$("evt_edition_lib2").value,$("evt_edition_date_deb").value,$("evt_edition_heure_deb").value,$("evt_edition_date_fin").value,$("evt_edition_heure_fin").value,$("evt_edition_note").value);gride_is_locked=false}}function MajEventLocation(a){if(autoUpdate&&panneau_edition_verifier_formulaire()){agenda_operation_maj_event_location(a,$("id_graphic_event").value,$("evt_edition_agenda_selected").options[$("evt_edition_agenda_selected").selectedIndex].value,$("evt_edition_type_event_selected").options[$("evt_edition_type_event_selected").selectedIndex].value,$("ref_event").value,$("evt_edition_lib2").value,$("evt_edition_date_deb").value,$("evt_edition_heure_deb").value,$("evt_edition_date_fin").value,$("evt_edition_heure_fin").value,$("evt_edition_note").value,$("evt_choix_stock").value,$("evt_edition_qte").value);gride_is_locked=false}}function DelEvent(a){agenda_operation_delete_event(a,$("id_graphic_event").value,$("ref_event").value)}function disableContenu(a){inputs=$(a).getElementsByTagName("input");for(i=0;i<inputs.length;i++){$(inputs[i].id).setAttribute("readonly","readonly")}textareas=$(a).getElementsByTagName("textarea");for(i=0;i<textareas.length;i++){$(textareas[i].id).setAttribute("readonly","readonly")}selects=$(a).getElementsByTagName("select");for(i=0;i<selects.length;i++){$(selects[i].id).disabled=true}$("MajEvent").style.visibility="hidden";$("SupprimerEvent").style.visibility="hidden"}function enableContenu(a){inputs=$(a).getElementsByTagName("input");for(i=0;i<inputs.length;i++){$(inputs[i].id).removeAttribute("readonly")}textareas=$(a).getElementsByTagName("textarea");for(i=0;i<textareas.length;i++){$(textareas[i].id).removeAttribute("readonly")}selects=$(a).getElementsByTagName("select");for(i=0;i<selects.length;i++){$(selects[i].id).disabled=false}$("MajEvent").style.visibility="visible";$("SupprimerEvent").style.visibility="visible"}function read_cook(b){var a,c;a=document.cookie.indexOf(b+"=");if(a>=0){a+=b.length+1;c=document.cookie.indexOf(";",a);if(c<0){c=document.cookie.length}return unescape(document.cookie.substring(a,c))}return""};